<head>
  <style>
   table {
     border: 1px solid black;
     font-size: 2vw;
     border-spacing: 3px;
   }
   table tr td:nth-child(even) { background: #00ffff; }
   table tr td:nth-child(odd) { background: #aaffff; }

   table tr th:nth-child(even) { background: #00ffff; }
   table tr th:nth-child(odd) { background: #aaffff; }

   td { text-align: center; border-left: 1px solid black; }
   th { text-align: center; border-left: 1px solid black; }
   input { font-size: 2vw; }
   input[type='checkbox'] { width: 2vw; height: 2vw; }
  </style>
</head>
<script>
 var keep_arrival_requesting = true;
</script>
<body bgcolor="#D8BCAB">
  <h1 align="center">Santa Clara University Maker Laboratory</h1>
  <form align="center" action="/update-user" name="update_user" id="update_user" method="post" onsubmit="{ keep_arrival_requesting=false; }">
    <input id="user_rfid" type="hidden" name="user_rfid"/>
    <table>
      <tr>
        <th>Name</th>
        <th>3D Printer</th>
        <th>Laser</th>
        <th>Vinyl</th>
        <th>CNC</th>
        <th>DrillPress</th>
        <th>Electronics</th>
        <th></th>
      </tr>
      <tr>
        <td><input id="user_name" type="text" size="30 "name="user_name"/></td>
        <td><input id="perm_printer3d" type="checkbox" name="perm_printer3d"/></td>
        <td><input id="perm_laser" type="checkbox" name="perm_laser"/></td>
        <td><input id="perm_vinyl" type="checkbox" name="perm_vinyl"/></td>
        <td><input id="perm_cnc" type="checkbox" name="perm_cnc"/></td>
        <td><input id="perm_drillpress" type="checkbox" name="perm_drillpress"/></td>
        <td><input id="perm_electronics" type="checkbox" name="perm_electronics"/></td>
        <td><button type="submit" name="update" value="Update" style="font-size: 2vw;">Update</button></td>
      </tr>
    </table>
  </form>
  <script>
   function updateForm(json_string) {
     if (json_string == undefined || json_string == "") return;
     obj = JSON.parse(json_string)
     if (obj.user_rfid == undefined) return;
     document.getElementById("user_name").value=obj.user_name;
     if (obj.user_name == "") {
       document.getElementById("user_name").placeholder="New user " + obj.user_rfid;
     }
     document.getElementById("user_rfid").value=obj.user_rfid;
     for (key in obj) {
       if (key.startsWith("perm_")) {
         document.getElementById(key).checked=obj[key];
       }
     }
   }

   function fetchJsonAndProcess(url, fun) {
     var xmlhttp = new XMLHttpRequest();
     xmlhttp.onreadystatechange = function() {
       if (xmlhttp.readyState != 4) return;
       fun(xmlhttp.responseText)
     }
     xmlhttp.open("GET", url, true);
     xmlhttp.send();
   }

   function updateArrival() {
     if (!keep_arrival_requesting) return;
     fetchJsonAndProcess("/arrival", function(str) {
       updateForm(str);
       updateArrival();
     });
   }

   function initialSet() {
     fetchJsonAndProcess("/last-user", function(str) {
       updateForm(str);
       updateArrival();
     })
   }

   initialSet();
  </script>
</body>
